<!DOCTYPE html>
<html>
<head>
    <title>Sistema de Gestión de Inventario</title>
    <link rel="stylesheet" type="text/css" href="styles.css">
    <script src="https://cdn.jsdelivr.net/jsbarcode/3.11.0/JsBarcode.all.min.js"></script>
</head>
<body>
    <h1>Inventario</h1>
    <div id="scanner">
        <video id="camera" autoplay></video>
        <button id="scan-button">Escanear Código de Barras</button>
    </div>
    <div id="manual-entry">
        <h2>Ingreso Manual</h2>
        <input type="text" id="manual-barcode" placeholder="Código de Barras">
        <button id="generate-barcode">Generar Código de Barras</button>
    </div>
    <div id="inventory">
        <!-- Aquí se mostrará la lista de productos -->
    </div>
    <div id="product-form">
        <h2>Agregar/Editar Producto</h2>
        <input type="text" id="product-name" placeholder="Nombre del producto">
        <input type="number" id="product-quantity" placeholder="Cantidad">
        <input type="number" id="product-price" placeholder="Precio">
        <button id="add-product">Guardar Producto</button>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const inventoryElement = document.getElementById("inventory");
            const productNameInput = document.getElementById("product-name");
            const productQuantityInput = document.getElementById("product-quantity");
            const productPriceInput = document.getElementById("product-price");
            const addProductButton = document.getElementById("add-product");
            const scanButton = document.getElementById("scan-button");
            const manualBarcodeInput = document.getElementById("manual-barcode");
            const generateBarcodeButton = document.getElementById("generate-barcode");
            const barcodeSVG = document.getElementById("barcode");

            // Accede a la cámara del dispositivo y muestra la imagen en el elemento de video
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(function (stream) {
                    const camera = document.getElementById("camera");
                    camera.srcObject = stream;
                })
                .catch(function (error) {
                    console.error("Error al acceder a la cámara: " + error);
                });

            // Array para almacenar productos
            let inventory = JSON.parse(localStorage.getItem("inventory")) || [];

            // Función para mostrar la lista de productos
            function renderInventory() {
                inventoryElement.innerHTML = "";
                inventory.forEach((product, index) => {
                    const productItem = document.createElement("div");
                    productItem.innerHTML = `
                        <strong>${product.name}</strong> - 
                        Cantidad: ${product.quantity} - 
                        Precio: $${product.price.toFixed(2)}
                        <button class="edit-button" data-index="${index}">Editar</button>
                        <button class="delete-button" data-index="${index}">Eliminar</button>`;
                    inventoryElement.appendChild(productItem);
                });

                // Agregar oyentes de eventos a los botones de eliminar y editar
                const deleteButtons = document.querySelectorAll(".delete-button");
                deleteButtons.forEach((button) => {
                    button.addEventListener("click", handleDelete);
                });
                const editButtons = document.querySelectorAll(".edit-button");
                editButtons.forEach((button) => {
                    button.addEventListener("click", handleEdit);
                });
            }

            // Función para agregar o editar un producto en el inventario
            function addOrUpdateProduct() {
                const name = productNameInput.value;
                const quantity = parseInt(productQuantityInput.value);
                const price = parseFloat(productPriceInput.value);

                if (name && quantity >= 0 && price >= 0) {
                    const product = { name, quantity, price };
                    const index = inventory.findIndex(p => p.name === name);

                    if (index !== -1) {
                        // Si ya existe, actualiza el producto
                        inventory[index] = product;
                    } else {
                        // Si no existe, agrega el producto
                        inventory.push(product);
                    }

                    // Limpia los campos de entrada
                    productNameInput.value = "";
                    productQuantityInput.value = "";
                    productPriceInput.value = "";

                    // Actualiza el almacenamiento local y muestra el inventario
                    localStorage.setItem("inventory", JSON.stringify(inventory));
                    renderInventory();
                }
            }

            // Función para eliminar un producto del inventario
            function handleDelete(event) {
                const index = event.target.getAttribute("data-index");
                inventory.splice(index, 1);
                localStorage.setItem("inventory", JSON.stringify(inventory));
                renderInventory();
            }

            // Función para editar un producto
            function handleEdit(event) {
                const index = event.target.getAttribute("data-index");
                const product = inventory[index];
                productNameInput.value = product.name;
                productQuantityInput.value = product.quantity;
                productPriceInput.value = product.price;
            }

            // Función para generar un código de barras manualmente
            function generateBarcodeManually() {
                const manualBarcode = manualBarcodeInput.value;

                if (manualBarcode) {
                    // Agregar el código de barras a la lista de productos
                    const product = { name: manualBarcode, quantity: 0, price: 0.00 };
                    inventory.push(product);
                    localStorage.setItem("inventory", JSON.stringify(inventory));
                    renderInventory();
                    manualBarcodeInput.value = "";

                    // Generar el código de barras y mostrarlo
                    JsBarcode(barcodeSVG, manualBarcode, {
                        format: "CODE128",
                        displayValue: true
                    });
                }
            }

            // Escuchar eventos de botones
            addProductButton.addEventListener("click", addOrUpdateProduct);
            scanButton.addEventListener("click", () => {
                alert("Función de escaneo no implementada en este ejemplo.");
            });
            generateBarcodeButton.addEventListener("click", generateBarcodeManually);

            // Mostrar el inventario al cargar la página
            renderInventory();
        });
    </script>
</body>
</html>
